---

- name: set timezone to Asia/Tokyo
  become: yes
  timezone:
    name: Asia/Tokyo

- name: dpkg-reconfigure tzdata
  become: yes
  shell: dpkg-reconfigure --frontend noninteractive tzdata

- name: change ubuntu apt repository
  become: yes
  replace:
    dest: /etc/apt/sources.list
    regexp: 'http://archive.ubuntu.com/ubuntu'
    replace: 'http://ftp.yz.yamagata-u.ac.jp/pub/linux/ubuntu/archives'
  register: change_apt_repo

- name: add apt key
  become: yes
  apt_key:
    url: "{{ item }}"
    state: present
  with_items:
    - https://www.ubuntulinux.jp/ubuntu-ja-archive-keyring.gpg
    - https://www.ubuntulinux.jp/ubuntu-jp-ppa-keyring.gpg

- name: add apt repository
  become: yes
  get_url:
    url: https://www.ubuntulinux.jp/sources.list.d/trusty.list
    dest: /etc/apt/sources.list.d/ubuntu-ja.list
  register: add_apt_repo

- name: install packages
  become: yes
  apt:
    name: "{{ item }}"
    state: present
    update_cache: "{{ change_apt_repo|changed or add_apt_repo|changed }}"
  with_items:
    - ubuntu-desktop
    - ubuntu-defaults-ja
